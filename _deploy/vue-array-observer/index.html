<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.2.3 --> <title>看源码：vue是怎么监听数组变化 | leedsrourou</title> <meta property="og:title" content="看源码：vue是怎么监听数组变化" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="对数组的操作是不能通过get set来响应的，所以vue对于数组的操作，" /> <meta property="og:description" content="对数组的操作是不能通过get set来响应的，所以vue对于数组的操作，" /> <link rel="canonical" href="http://localhost:4000/vue-array-observer/" /> <meta property="og:url" content="http://localhost:4000/vue-array-observer/" /> <meta property="og:site_name" content="leedsrourou" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2017-02-05T00:00:00+08:00" /> <script type="application/ld+json"> {"@context":"http://schema.org","@type":"BlogPosting","headline":"看源码：vue是怎么监听数组变化","datePublished":"2017-02-05T00:00:00+08:00","dateModified":"2017-02-05T00:00:00+08:00","description":"对数组的操作是不能通过get set来响应的，所以vue对于数组的操作，","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/vue-array-observer/"},"url":"http://localhost:4000/vue-array-observer/"}</script> <!-- End Jekyll SEO tag --> <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> <link rel="stylesheet" href="/css/main.css"> <link rel="alternate" type="application/rss+xml" title="leedsrourou" href="http://localhost:4000/feed.xml"> </head> <body> <header class="site-header"> <nav class="navbar navbar-default"> <div class="container-fluid"> <!-- Brand and toggle get grouped for better mobile display --> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">leedsrourou</a> </div> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse " id="bs-example-navbar-collapse-1"> <ul class="nav navbar-nav navbar-right"> <li><a href="/about/">About</a></li> <li><a href="/contact/">Contact</a></li> <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Download <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a target="_blank" href="https://github.com/sharu725/cards">Project</a></li> <li><a href="https://github.com/sharu725/cards/archive/master.zip">Download</a></li> <li role="separator" class="divider"></li> <li><a target="_blank" href="https://jekyll-themes.com">More Themes</a></li> </ul> </li> </ul> </div><!-- /.navbar-collapse --> </div><!-- /.container-fluid --> </nav> </header> <div class="container"> <div class="wrapper"> <div class="row"> <div class="col-md-8"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">看源码：vue是怎么监听数组变化</h1> <p class="post-meta"><time datetime="2017-02-05T00:00:00+08:00" itemprop="datePublished">Feb 5, 2017</time></p> </header> <div class="post-content" itemprop="articleBody"> <p>对数组的操作是不能通过get set来响应的，所以vue对于数组的操作，</p> <p>如下图数组内的这些操作，都重写了Array的原生方法，</p> <p>对于push unshift 和 splice的添加操作，对新的数组元素进行监听 在重写的办法中，手动触发dep.notify()方法进行响应</p> <div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">arrayProto</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">arrayMethods</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">arrayProto</span><span class="p">);[</span>
    <span class="s1">'push'</span><span class="p">,</span>
    <span class="s1">'pop'</span><span class="p">,</span>
    <span class="s1">'shift'</span><span class="p">,</span>
    <span class="s1">'unshift'</span><span class="p">,</span>
    <span class="s1">'splice'</span><span class="p">,</span>
    <span class="s1">'sort'</span><span class="p">,</span>
    <span class="s1">'reverse'</span>
  <span class="p">]</span>
  <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// cache original method</span>
    <span class="kd">var</span> <span class="nx">original</span> <span class="o">=</span> <span class="nx">arrayProto</span><span class="p">[</span><span class="nx">method</span><span class="p">];</span>
    <span class="nx">def</span><span class="p">(</span><span class="nx">arrayMethods</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">mutator</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">arguments$1</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>

      <span class="c1">// avoid leaking arguments:</span>
      <span class="c1">// http://jsperf.com/closure-with-arguments</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments$1</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">original</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">ob</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__ob__</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">inserted</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">'push'</span><span class="err">:</span>
          <span class="nx">inserted</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
          <span class="k">break</span>
        <span class="k">case</span> <span class="s1">'unshift'</span><span class="err">:</span>
          <span class="nx">inserted</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
          <span class="k">break</span>
        <span class="k">case</span> <span class="s1">'splice'</span><span class="err">:</span>
          <span class="nx">inserted</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
          <span class="k">break</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">inserted</span><span class="p">)</span> <span class="p">{</span> <span class="nx">ob</span><span class="p">.</span><span class="nx">observeArray</span><span class="p">(</span><span class="nx">inserted</span><span class="p">);</span> <span class="p">}</span>
      <span class="c1">// notify change</span>
      <span class="nx">ob</span><span class="p">.</span><span class="nx">dep</span><span class="p">.</span><span class="nx">notify</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">result</span>
    <span class="p">});</span>
  <span class="p">});</span>
</code></pre></div> </div> </article> <div class="row"> </div> <div class="row"> <ul class="pager"> <li><a class="next" href="/node/">&laquo; 深入浅出node笔记</a></li> <li><a class="previous" href="/vue-mount/">看源码：简单例子来窥探一下vue mount的过程 &raquo;</a></li> </ul> </div> </div> <div class="col-md-4 mt20"> <div class="mt10 recent"> <h2>Recent articles</h2> <ul> <li> <p><a href="/node/">深入浅出node笔记</a><small>&nbsp;&nbsp;31 May 2017</small></p> </li> <li> <p><a href="/vue-mount/">看源码：简单例子来窥探一下vue mount的过程</a><small>&nbsp;&nbsp;03 Feb 2017</small></p> </li> <li> <p><a href="/vue-update/">看源码：简单例子来窥探一下vue update</a><small>&nbsp;&nbsp;02 Feb 2017</small></p> </li> </ul> </div> </div> </div> <div id="fb-root"></div> <script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId="; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script> </div> </div> <footer> <div class="container"> <div class="row p20"> <div class="col-md-4 text-center mt25" > </div> <div class="col-md-4 text-center mt25"> <a target="_blank" href=""><li class="social facebook"><img src="/images/facebook.svg" alt=""></li></a> <a target="_blank" href=""><li class="social quora"><img src="/images/quora.svg" alt=""></li></a> <a target="_blank" href=""><li class="social twitter"><img src="/images/twitter.svg" alt=""></li></a> <a target="_blank" href=""><li class="social github"><img src="/images/github.svg" alt=""></li></a> </div> </div> </div> </footer> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script> <script src="/js/bootstrap.min.js"></script> </body> </html>
