<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/tomorrow.css" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>vue-update</title>
</head>

<body>
<div id="container">
  <div class="inner">
    <header>
        <h1>简单例子来窥探一下vue update的过程</h1>
        <h2>ctyunaw</h2>
    </header>
    <section id="downloads" class="clearfix">
        <a href="https://github.com/moumoutang" id="view-on-github" class="button"><span>View on GitHub</span></a>
    </section>
    <hr>
    <section id="main_content">
    <p>
      之前有一篇大概讲了讲mount的过程：<a href="/vue-mount">简单例子来窥探一下vue mount的过程</a>
      <br>
      还接着那个例子来说，为了看到update过程，将click的响应稍微改动一下
    </p>
    <pre>
    <code>
      haha: function(){
        this.currentBranch = "develop"
      }
    </code>
    </pre>
    <p>
      因为是设值，所以自然跳到了对应的set方法<br>
      没有相对应的setter，需要observe，但是因为只是一个字符串值，不需要进行监听，
      如果是object或者数组等引用类型的值就需要加上新的监听<br>
      到了关键的dep.notify()<br><br>
      那么此时dep的值是什么呢？<br>
      我们回顾上一次讲mount的时候，在执行eval函数的时候会调用到get句柄，在此时给每个被监听的值上加了watcher<br>
    </p>
    <pre>
      <code>
  Object.defineProperty(obj, key, {
    enumerable: true,
    configurable: true,
    get: function reactiveGetter () {
      ...
    },
    set: function reactiveSetter (newVal) {
      var value = getter ? getter.call(obj) : val;
      /* eslint-disable no-self-compare */
      if (newVal === value || (newVal !== newVal && value !== value)) {
        return
      }
      /* eslint-enable no-self-compare */
      if ("development" !== 'production' && customSetter) {
        customSetter();
      }
      if (setter) {
        setter.call(obj, newVal);
      } else {
        val = newVal;
      }
      childOb = observe(newVal);
      dep.notify();
    }
  });
      </code>
    </pre>
    <img src="images/vue/2017-04-20_14-52-14.png" />
    <p>
    我们会发现对于currentBranch有两个watcher <br>
    怎么会有两个咧？<br>
    原来前面还有个watch。。。
    </p>
    <pre>
      <code>
  watch: {
    currentBranch: 'fetchData'
  }
      </code>
    </pre>
    

    </section>
<footer>
    This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
</footer>
<script type="text/javascript" src="https://highlightjs.org/static/highlight.site.pack.js"></script>
<script type="text/javascript">
hljs.initHighlightingOnLoad()
</script>
</div>
</div>
</body>

</html>
