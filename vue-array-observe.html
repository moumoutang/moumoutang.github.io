<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/tomorrow.css" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>vue监听数组变化</title>
</head>

<body>
<div id="container">
  <div class="inner">
      <header>
          <h1>vue是怎么监听数组变化</h1>
          <h2>ctyunaw</h2>
      </header>
      <section id="downloads" class="clearfix">
          <a href="https://github.com/moumoutang" id="view-on-github" class="button"><span>View on GitHub</span></a>
      </section>
      <hr>
      <section id="main_content">
  <p>
    对数组的操作是不能通过get set来响应的，所以vue对于数组的操作，<br>
    如下图数组内的这些操作，都重写了Array的原生方法，<br>
    对于push  unshift 和 splice的添加操作，对新的数组元素进行监听<br>
    在重写的办法中，手动触发dep.notify()方法进行响应
  </p>
  <pre>
  <code>
  var arrayProto = Array.prototype;
  var arrayMethods = Object.create(arrayProto);[
    'push',
    'pop',
    'shift',
    'unshift',
    'splice',
    'sort',
    'reverse'
  ]
  .forEach(function (method) {
    // cache original method
    var original = arrayProto[method];
    def(arrayMethods, method, function mutator () {
      var arguments$1 = arguments;

      // avoid leaking arguments:
      // http://jsperf.com/closure-with-arguments
      var i = arguments.length;
      var args = new Array(i);
      while (i--) {
        args[i] = arguments$1[i];
      }
      var result = original.apply(this, args);
      var ob = this.__ob__;
      var inserted;
      switch (method) {
        case 'push':
          inserted = args;
          break
        case 'unshift':
          inserted = args;
          break
        case 'splice':
          inserted = args.slice(2);
          break
      }
      if (inserted) { ob.observeArray(inserted); }
      // notify change
      ob.dep.notify();
      return result
    });
  });
  </code>
  </pre>
      </section>
      <footer>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
      </footer>
      <script type="text/javascript" src="https://highlightjs.org/static/highlight.site.pack.js"></script>
      <script type="text/javascript">
      hljs.initHighlightingOnLoad()
      </script>
  </div>
</div>
</body>

</html>
